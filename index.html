<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>fb-messenger-bot-api</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.js" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">fb-messenger-bot-api</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1> fb-messenger-bot-api</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<h1 id="fb-messenger-bot-api">fb-messenger-bot-api</h1>
				<h4 id="nodejs-facebook-messenger-api">NodeJS Facebook Messenger API</h4>
				<p><a href="http://npm.im/fb-messenger-bot-api"><img src="https://img.shields.io/npm/v/fb-messenger-bot-api.svg" alt="version"></a>
					<a href="https://travis-ci.org/crisboarna/fb-messenger-bot-api"><img src="https://img.shields.io/travis/crisboarna/fb-messenger-bot-api.svg" alt="travis build"></a>
					<a href="https://codecov.io/gh/crisboarna/fb-messenger-bot-api"><img src="https://img.shields.io/codecov/c/github/crisboarna/fb-messenger-bot-api.svg" alt="codecov coverage"></a>
					<a href="https://david-dm.org/crisboarna/fb-messenger-bot-api"><img src="https://img.shields.io/david/crisboarna/fb-messenger-bot-api.svg" alt="dependency status"></a>
					<a href="https://snyk.io/test/github/crisboarna/fb-messenger-bot-api?targetFile=package.json"><img src="https://snyk.io/test/github/crisboarna/fb-messenger-bot-api/badge.svg?targetFile=package.json" alt="Known Vulnerabilities"></a>
					<a href="https://www.codacy.com/app/crisboarna/fb-messenger-bot-api?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=crisboarna/fb-messenger-bot-api&amp;utm_campaign=Badge_Grade"><img src="https://api.codacy.com/project/badge/Grade/8d87ae38dea34aa09d0daa0ab81b81cd" alt="Codacy Badge"></a>
					<a href="http://opensource.org/licenses/MIT"><img src="https://img.shields.io/npm/l/fb-messenger-bot-api.svg" alt="MIT License"></a>
					<a href="https://github.com/semantic-release/semantic-release"><img src="https://img.shields.io/badge/%20%20%F0%9F%93%A6%F0%9F%9A%80-semantic--release-e10079.svg?style=flat-square" alt="semantic-release"></a>
					<a href="http://commitizen.github.io/cz-cli/"><img src="https://img.shields.io/badge/commitizen-friendly-brightgreen.svg?style=flat-square" alt="Commitizen friendly"></a>
					<img src="https://img.shields.io/badge/stability-stable-green.svg" alt="stability-stable">
					<a href="https://greenkeeper.io/"><img src="https://badges.greenkeeper.io/crisboarna/fb-messenger-bot-api.svg" alt="Greenkeeper"></a>
				<a href="https://img.shields.io/badge/code%20style-airbnb-brightgreen.svg"><img src="https://img.shields.io/badge/code%20style-airbnb-brightgreen.svg" alt="code style"></a></p>
				<h2 id="installation">Installation</h2>
				<pre><code>npm <span class="hljs-keyword">install</span> fb-messenger-bot-api</code></pre><h2 id="table-of-contents">Table of Contents</h2>
				<ul>
					<li><a href="#documentation">Documentation</a></li>
					<li><a href="#features">Features</a></li>
					<li><a href="#setup">Setup</a></li>
					<li><a href="#sending-messages">Sending Messages</a><ul>
							<li><a href="#text-message">Text Message</a></li>
							<li><a href="#image-message">Image Message</a></li>
							<li><a href="#buttons-message">Buttons Message</a></li>
							<li><a href="#quick-reply-message">Quick Reply Message</a></li>
							<li><a href="#generic-template-list-(-horizontal-scroll-list-)">Generic Template List ( Horizontal Scroll List)</a></li>
							<li><a href="#list-message-(-vertical-scroll-list-)">List Message ( Vertical Scroll List)</a></li>
							<li><a href="#mark-as-seen">Mark as Seen</a></li>
							<li><a href="#toggle-writing-bubble">Toggle Writing Bubble</a></li>
							<li><a href="#user-profile">User Profile</a></li>
						</ul>
					</li>
					<li><a href="#incoming-message-parser">Incoming Message Parser</a>  </li>
					<li><a href="#setting-messenger-profile">Setting Messenger Profile</a><ul>
							<li><a href="#setting-greeting-message">Setting Greeting Message</a></li>
							<li><a href="#setting-get-started-button">Setting Get Started Button</a></li>
							<li><a href="#setting-persistent-menu">Setting Persistent Menu</a></li>
						</ul>
					</li>
					<li><a href="#sending-facebook-page-posts">Sending Facebook Page Posts</a><ul>
							<li><a href="#page-image-posts">Page Image Posts</a></li>
							<li><a href="#page-link-posts">Page Link Posts</a></li>
						</ul>
					</li>
					<li><a href="#validating-facebook-webhook">Validating Facebook Webhook</a><ul>
							<li><a href="#server-validation">Server Validation</a></li>
							<li><a href="#lambda-validation">Lambda Validation</a></li>
						</ul>
					</li>
					<li><a href="#validating-message-integrity">Validating Message Integrity</a>  </li>
					<li><a href="#complete-example">Complete Examples</a></li>
					<li><a href="#creating-facebook-app">Creating Facebook App</a></li>
				</ul>
				<h2 id="documentation">Documentation</h2>
				<p>You can find documentation <a href="https://crisboarna.github.io/fb-messenger-bot-api/">here</a></p>
				<h2 id="features">Features</h2>
				<ul>
					<li>Near complete Typescript types for all incoming/outgoing Facebook Messaging API payloads &amp; webhooks</li>
					<li>Builders for all types of buttons/templates</li>
					<li>Incoming Message Parser &amp; Extractor</li>
					<li>Webhook Validation logic </li>
					<li>Page posting</li>
					<li>Profile interactions </li>
					<li>Promises and callback support on all functions, if no callback provided, promise returned, allows you to manage flow as you desire AND to <b>ensure message ordering</b><br /></li>
					<li>Supports proxying</li>
					<li>Typescript code with exported types for every end-point input/output</li>
					<li>Using latest Facebook API v3.1</li>
				</ul>
				<h2 id="setup">Setup</h2>
				<p>Import</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> facebook = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fb-messenger-bot-api'</span>);</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { FacebookMessagingAPIClient, etc... } <span class="hljs-keyword">from</span> <span class="hljs-string">'fb-messenger-bot-api'</span>;</code></pre>
				<h2 id="sending-messages">Sending Messages</h2>
				<p>Initialize</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> messageClient = <span class="hljs-keyword">new</span> facebook.FacebookMessagingAPIClient(process.env.PAGE_ACCESS_TOKEN);</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> messageClient = <span class="hljs-keyword">new</span> FacebookMessagingAPIClient(process.env.PAGE_ACCESS_TOKEN);</code></pre>
				<p>Using proxy</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> messageClient = <span class="hljs-keyword">new</span> facebook.FacebookMessagingAPIClient(process.env.PAGE_ACCESS_TOKEN, { <span class="hljs-attr">hostname</span>:process.env.PROXY_HOST, <span class="hljs-attr">port</span>: process.env.PROXY_PORT });</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> messageClient = <span class="hljs-keyword">new</span> FacebookMessagingAPIClient(process.env.PAGE_ACCESS_TOKEN, { hostname:process.env.PROXY_HOST, port: process.env.PROXY_PORT });</code></pre>
				<p>Defaults to <code>http</code> if no protocol provided</p>
				<h3 id="text-message">Text Message</h3>
				<pre><code class="language-javascript">messageClient.sendTextMessage(senderId, &lt;MESSAGE&gt;)
    .then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> ...)</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">await</span> messageClient.sentTextMessage(senderId, &lt;MESSAGE&gt;);</code></pre>
				<h3 id="image-message">Image Message</h3>
				<pre><code class="language-javascript">messageClient.sendImageMessage(senderId, &lt;IMAGE_URL&gt;)
    .then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> ...)</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> messageClient.sendImageMessage(senderId, &lt;IMAGE_URL&gt;)</code></pre>
				<p>This method will have the image cached by facebook so every receiver after the first will get it quickly.</p>
				<h3 id="buttons-message">Buttons Message</h3>
				<pre><code class="language-javascript">messageClient.sendButtonsMessage(senderId, &lt;BUTTONS TEXT&gt; [<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ARRAY</span> <span class="hljs-attr">OF</span> <span class="hljs-attr">BUTTONS</span>&gt;</span>])
    .then((result) =&gt; ...)</span></code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> messageClient.sendButtonsMessage(senderId, &lt;BUTTONS TEXT&gt; [&lt;ARRAY OF BUTTONS&gt;])</code></pre>
				<p><a href="https://developers.facebook.com/docs/messenger-platform/send-messages/template/button">Buttons format</a></p>
				<h3 id="quick-reply-message">Quick Reply Message</h3>
				<pre><code class="language-javascript">messageClient.sendQuickReplyMessage(senderId, &lt;TEXT&gt;, [<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">QUICK_REPLIES</span>&gt;</span>])
    .then((result) =&gt; ...)</span></code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> messageClient.sendQuickReplyMessage(senderId, &lt;TEXT&gt;, [&lt;QUICK_REPLIES&gt;])</code></pre>
				<p><a href="https://developers.facebook.com/docs/messenger-platform/send-messages/quick-replies">Quick Reply format</a></p>
				<h3 id="generic-template-message-horizontal-scroll-list-">Generic Template Message ( Horizontal Scroll List )</h3>
				<pre><code class="language-javascript">messageClient.sendGenericTemplate(senderId, [ELEMENTS])
    .then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> ...)</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> messageClient.sendGenericTemplate(senderId, [ELEMENTS])</code></pre>
				<p><a href="https://developers.facebook.com/docs/messenger-platform/send-messages/template/generic">Generic Template element format</a></p>
				<h3 id="list-message-vertical-scroll-list-">List Message ( Vertical Scroll List )</h3>
				<pre><code class="language-javascript">messageClient.sendListMessage(senderId, [ELEMENTS], &lt;firstElementStyle&gt;, [FINAL_BUTTONS])
    .then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> ...)</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> messageClient.sendListMessage(senderId, [ELEMENTS], &lt;firstElementStyle&gt;, [FINAL_BUTTONS])</code></pre>
				<p><code>firstElementStyle</code> is optional. If not provided defaults to <code>large</code></p>
				<p><a href="https://developers.facebook.com/docs/messenger-platform/send-messages/template/list">List Template element format</a></p>
				<h3 id="mark-as-seen">Mark as Seen</h3>
				<pre><code class="language-javascript">messageClient.markSeen(senderId);</code></pre>
				<p>As per all methods, callback can be provided. If no callback provided returns promise. Recommended to send and continue processing without waiting for reply.</p>
				<h3 id="toggle-writing-bubble">Toggle writing bubble</h3>
				<pre><code class="language-javascript">messageClient.toggleTyping(senderId, &lt;<span class="hljs-literal">true</span>/<span class="hljs-literal">false</span>&gt;);</code></pre>
				<p>As per all methods, callback can be provided. If no callback provided returns promise. Recommended to send and continue processing without waiting for reply.
				Defaults to <code>false</code> if no boolean parameter provided.</p>
				<h3 id="user-profile">User Profile</h3>
				<pre><code class="language-javascript">messageClient.getUserProfile(senderId,[<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PROPERTIES</span>&gt;</span>])
    .then((result) =&gt; ...)</span></code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> messageClient.getUserProfile(senderId,[&lt;PROPERTIES&gt;])</code></pre>
				<p>Valid properties: <code>first_name</code>,<code>last_name</code>,<code>profile_pic</code>,<code>locale</code>,<code>timezone</code>,<code>gender</code>,<code>is_payment_enabled</code>,<code>last_ad_referral</code>
				If none are given defaults to <code>first_name</code> only.</p>
				<h2 id="incoming-message-parser">Incoming Message Parser</h2>
				<p>Extracts all relevant &amp; known message types that can be found <a href="https://developers.facebook.com/docs/messenger-platform/reference/webhook-events">here</a>. Returns array with all objects of interest. Left flexibility to user to filter out message types of interest per use case instead of returning dictionary object with each message type as a separate list for optional performance saving in case of usage on time sensitive platforms (AWS Lambda, AF, GCF, etc).</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {FacebookMessageParser} <span class="hljs-keyword">from</span> <span class="hljs-string">'fb-messenger-bot-api'</span>;
<span class="hljs-keyword">const</span> messages = FacebookMessageParser.parsePayload(incomingPayload);</code></pre>
				<h2 id="setting-messenger-profile">Setting Messenger Profile</h2>
				<p>Initialize</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> profileClient = <span class="hljs-keyword">new</span> facebook.FacebookProfileAPIClient(process.env.PAGE_ACCESS_TOKEN);</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {Profile} <span class="hljs-keyword">from</span> <span class="hljs-string">'fb-messenger-bot-api'</span>;
<span class="hljs-keyword">const</span> profileClient = <span class="hljs-keyword">new</span> FacebookProfileAPIClient(process.env.PAGE_ACCESS_TOKEN);</code></pre>
				<p>Using proxy</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> profileClient = <span class="hljs-keyword">new</span> facebook.FacebookProfileAPIClient(process.env.PAGE_ACCESS_TOKEN, { <span class="hljs-attr">hostname</span>:process.env.PROXY_HOST, <span class="hljs-attr">port</span>: process.env.PROXY_PORT });</code></pre>
				<h3 id="setting-greeting-message">Setting Greeting Message</h3>
				<pre><code class="language-javascript">profileClient.setGreetingMessage(<span class="hljs-string">'Message that will be visible first thing when opening chat window with your bot/page'</span>)
.then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> ...)</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> profileClient.setGreetingMessage(<span class="hljs-string">'Message that will be visible first thing when opening chat window with your bot/page'</span>);</code></pre>
				<h3 id="setting-get-started-button">Setting Get Started button</h3>
				<pre><code class="language-javascript">profileClient.setGetStartedAction(senderId, payload)
    .then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> ...)</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> profileClient.setGetStartedAction(senderId, payload)</code></pre>
				<p><code>payload</code> is the value that will be first sent when new user sends first message, once per user interaction</p>
				<h3 id="setting-persistent-menu">Setting Persistent Menu</h3>
				<pre><code class="language-javascript">profileClient.setPersistentMenu(senderId, [<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MENU_ENTRIES</span>&gt;</span>])
    .then((result) =&gt; ...)</span></code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> profileClient.setPersistentMenu(senderId, [&lt;MENU_ENTRIES&gt;])</code></pre>
				<p>This is a burger menu appearing next to the chat input field where users can click and get direct interaction shortcuts to specific functionality of the bot.
				<a href="https://developers.facebook.com/docs/messenger-platform/reference/messenger-profile-api/persistent-menu">Persistent menu format</a></p>
				<h2 id="sending-facebook-page-posts">Sending Facebook Page Posts</h2>
				<p>Initialize</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> pageClient = <span class="hljs-keyword">new</span> facebook.FacebookPageAPIClient(process.env.PAGE_ID, process.env.PAGE_ACCESS_TOKEN);</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {FacebookPageAPIClient} <span class="hljs-keyword">from</span> <span class="hljs-string">'fb-messenger-bot-api'</span>;
<span class="hljs-keyword">const</span> pageClient = <span class="hljs-keyword">new</span> FacebookPageAPIClient(process.env.PAGE_ID, process.env.PAGE_ACCESS_TOKEN)</code></pre>
				<p>Using proxy</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> pageClient = <span class="hljs-keyword">new</span> facebook.FacebookPageAPIClient(process.env.PAGE_ID, process.env.PAGE_ACCESS_TOKEN, { <span class="hljs-attr">hostname</span>:process.env.PROXY_HOST, <span class="hljs-attr">port</span>: process.env.PROXY_PORT });</code></pre>
				<p>Defaults to <code>http</code> if no protocol provided</p>
				<p>Requires a never expiring <code>publishing_actions</code> token that can be obtained by following <a href="https://www.rocketmarketinginc.com/blog/get-never-expiring-facebook-page-access-token/">this</a> guide.</p>
				<h3 id="page-image-posts">Page Image Posts</h3>
				<pre><code class="language-javascript">pageClient.imageUrl(<span class="hljs-string">`&lt;URL&gt;`</span>).imageCaption(<span class="hljs-string">`&lt;CAPTION&gt;`</span>).sendImage(<span class="hljs-string">`&lt;CALLBACK&gt;`</span>);</code></pre>
				<p><code>&lt;URL&gt;</code> is the url of the image being posted</p>
				<p><code>&lt;CAPTION&gt;</code> is the text you want on top of the image</p>
				<p><code>&lt;CALLBACK&gt;</code> is optional callback otherwise promise is returned</p>
				<h3 id="page-link-posts">Page Link Posts</h3>
				<pre><code class="language-javascript">pageClient.postUrl(<span class="hljs-string">`&lt;URL&gt;`</span>).postMessage(<span class="hljs-string">`&lt;MESSAGE&gt;`</span>).sendPost(<span class="hljs-string">`&lt;CALLBACK&gt;`</span>);</code></pre>
				<p><code>&lt;URL&gt;</code> is the url of the link being posted</p>
				<p><code>&lt;MESSAGE&gt;</code> is the text you want on top of the link</p>
				<p><code>&lt;CALLBACK&gt;</code> is optional callback otherwise promise is returned</p>
				<h2 id="validating-facebook-webhook">Validating Facebook Webhook</h2>
				<h3 id="server-validation">Server Validation</h3>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> facebook = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fb-messenger-bot-api'</span>);
<span class="hljs-keyword">const</span> router = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>).Router();
router.get(<span class="hljs-string">'/api/webhook'</span>,(req, res) =&gt; facebook.ValidateWebhook.validateServer(req,res));</code></pre>
				<p>Example based on usage with Express Router, can use any other middleware which passes in the req and response objects.
				Assumes verification token set under <code>process.env.FB_VERIFICATION_TOKEN</code>.</p>
				<p>Alternatively, if you want to pass in your set token in a different manner or under different name you can use </p>
				<pre><code class="language-javascript">ValidateWebhook.validateServer(req, res, &lt;TOKEN&gt;);</code></pre>
				<p>This allows you to obtain the value as you wish and still use it as above with the help of currying.</p>
				<pre><code class="language-javascript">...
const validateWebhook = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateWebhook</span>(<span class="hljs-params">token</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> facebook.ValidateWebhook.validateServer(req, res, token);
}
<span class="hljs-keyword">const</span> validator = validateWebhook(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">TOKEN</span>&gt;</span>);
router.get('/api/webhook/',validator);</span></code></pre>
				<h3 id="lambda-validation">Lambda Validation</h3>
				<p>Alternatively, you can use this when running on AWS Lambda to take advantage of the serverless paradigm as follows:</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {ValidateWebhook} <span class="hljs-keyword">from</span> <span class="hljs-string">'fb-messenger-bot-api'</span>;
<span class="hljs-keyword">const</span> handler = <span class="hljs-function">(<span class="hljs-params">event, context, callback: <span class="hljs-built_in">Function</span></span>) =&gt;</span> {
    ...
    <span class="hljs-keyword">if</span>(event.httpMethod === <span class="hljs-string">'GET'</span>) {
        ValidateWebhook.validateLambda(event, callback);
    }
    ...
}</code></pre>
				<p>Both <code>validateLambda</code> and <code>validateServer</code> support passing in verification token as third parameter. Otherwise will check <code>process.env.FB_VERIFICATION_TOKEN</code> for value.</p>
				<h2 id="validating-message-integrity">Validating Message Integrity</h2>
				<p>Validates the integrity of the message received from Facebook platform using the provided signature signed with Facebook Application Secret.</p>
				<p>The Facebook application secret can be provided either as second optional parameter to <code>ValidateWebhook.validateMessageIntegrity(&lt;X-HUB-SIGNATURE&gt;, &lt;FB_APPLICATION_SECRET&gt;)</code> or by setting <code>process.env.FB_APPLICATION_SECRET</code>.</p>
				<p>Compatible with both server/less paradigms as part of single line middleware function to Express or as Lambda first check before callback or remainder or programme.</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {ValidateWebhook} <span class="hljs-keyword">from</span> <span class="hljs-string">'fb-messenger-bot-api'</span>;
<span class="hljs-keyword">const</span> messageIntegrityChecker = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> validMessage = ValidateWebhook.validateMessageIntegrity(req.headers[<span class="hljs-string">"x-hub-signature"</span>]);
    ...
}
router.post(<span class="hljs-string">'/api/webhook/'</span>,messageIntegrityChecker);</code></pre>
				<h2 id="complete-example">Complete example</h2>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> router = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>).Router();
<span class="hljs-keyword">const</span> facebook = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fb-messenger-bot-api'</span>);
<span class="hljs-keyword">const</span> messagingClient = <span class="hljs-keyword">new</span> facebook.FacebookMessagingAPIClient(process.env.PAGE_ACCESS_TOKEN);
<span class="hljs-keyword">const</span> messageParser = facebook.FacebookMessageParser;
...
router.get(<span class="hljs-string">'/api/webhook'</span>,facebook.ValidateWebhook.validateServer);
router.post(<span class="hljs-string">'/api/webhook'</span>, (req, res) =&gt; {
    <span class="hljs-keyword">const</span> incomingMessages = messageParser.parsePayload(req.body);  
    ...
    messagingClient.markSeen(senderId)
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> client.toggleTyping(senderId,<span class="hljs-literal">true</span>))
        .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(error));
    ...
    <span class="hljs-comment">//promise based reaction on message send confirmation</span>
    messagingClient.sendTextMessage(senderId, <span class="hljs-string">'Hello'</span>)
        .then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Result sent with: <span class="hljs-subst">${result}</span>`</span>));
    ...
    <span class="hljs-comment">//callback based reaction on message confirmation</span>
    messagingClient.sendTextMessage(senderId, <span class="hljs-string">'Hello'</span>,(result) =&gt; <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Result sent with: <span class="hljs-subst">${result}</span>`</span>));
    ...
    <span class="hljs-comment">//silent message sending</span>
    messagingClient.sendTextMessage(senderId,<span class="hljs-string">'Hello'</span>);
})</code></pre>
				<p>or</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {FacebookMessagingAPIClient, ValidateWebhook, FacebookMessageParser} <span class="hljs-keyword">from</span> <span class="hljs-string">'fb-messenger-bot-api'</span>;
<span class="hljs-keyword">import</span> {Router} <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>;
...
router.get(<span class="hljs-string">'/api/webhook'</span>,facebook.ValidateWebhook.validateServer);
router.post(<span class="hljs-string">'/api/webhook'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> incomingMessages = messageParser.parsePayload(req.body);  
        ...
        <span class="hljs-keyword">await</span> messagingClient.markSeen(senderId);
        <span class="hljs-keyword">await</span> messagingClient.toggleTyping(senderId,<span class="hljs-literal">true</span>));
        ...
        <span class="hljs-comment">//promise based reaction on message send confirmation</span>
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> messagingClient.sendTextMessage(senderId, <span class="hljs-string">'Hello'</span>);
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Result sent with: <span class="hljs-subst">${result}</span>`</span>));
        ...
    } <span class="hljs-keyword">catch</span>(e){...}
    <span class="hljs-comment">//callback based reaction on message confirmation</span>
    messagingClient.sendTextMessage(senderId, <span class="hljs-string">'Hello'</span>,<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Result sent with: <span class="hljs-subst">${result}</span>`</span>));
    ...
    <span class="hljs-comment">//silent message sending</span>
    messagingClient.sendTextMessage(senderId,<span class="hljs-string">'Hello'</span>);
});</code></pre>
				<h2 id="creating-facebook-app">Creating Facebook app</h2>
				<p><a href="https://developers.facebook.com/docs/messenger-platform/guides/quick-start">See Facebook Guide</a></p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_quickreplybuilder_.html">"builders/<wbr>Quick<wbr>Reply<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_buttons_attachmentbuttonbuilder_.html">"builders/buttons/<wbr>Attachment<wbr>Button<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_buttons_buybuttonbuilder_.html">"builders/buttons/<wbr>Buy<wbr>Button<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_buttons_callbuttonbuilder_.html">"builders/buttons/<wbr>Call<wbr>Button<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_buttons_gameplaybuttonbuilder_.html">"builders/buttons/<wbr>Game<wbr>Play<wbr>Button<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_buttons_loginbuttonbuilder_.html">"builders/buttons/<wbr>Log<wbr>InButton<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_buttons_logoutbuttonbuilder_.html">"builders/buttons/<wbr>Log<wbr>Out<wbr>Button<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_buttons_postbackbuttonbuilder_.html">"builders/buttons/<wbr>Postback<wbr>Button<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_buttons_sharebuttonbuilder_.html">"builders/buttons/<wbr>Share<wbr>Button<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_buttons_urlbuttonbuilder_.html">"builders/buttons/URLButton<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_buttons_index_.html">"builders/buttons/index"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_index_.html">"builders/index"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_templates_airlineboardingpasstemplatebuilder_.html">"builders/templates/<wbr>Airline<wbr>Boarding<wbr>Pass<wbr>Template<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_templates_airlinecheckintemplatebuilder_.html">"builders/templates/<wbr>Airline<wbr>Check<wbr>InTemplate<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_templates_airlineflightupdatetemplatebuilder_.html">"builders/templates/<wbr>Airline<wbr>Flight<wbr>Update<wbr>Template<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_templates_airlineitinerarytemplatebuilder_.html">"builders/templates/<wbr>Airline<wbr>Itinerary<wbr>Template<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_templates_buttontemplatebuilder_.html">"builders/templates/<wbr>Button<wbr>Template<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_templates_generictemplatebuilder_.html">"builders/templates/<wbr>Generic<wbr>Template<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_templates_listtemplatebuilder_.html">"builders/templates/<wbr>List<wbr>Template<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_templates_mediatemplatebuilder_.html">"builders/templates/<wbr>Media<wbr>Template<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_templates_opengraphtemplatebuilder_.html">"builders/templates/<wbr>Open<wbr>Graph<wbr>Template<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_templates_receipttemplatebuilder_.html">"builders/templates/<wbr>Receipt<wbr>Template<wbr>Builder"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_builders_templates_index_.html">"builders/templates/index"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_quickreply_.html">"classes/<wbr>Quick<wbr>Reply"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_buttons_attachmentbuttonpayload_.html">"classes/buttons/<wbr>Attachment<wbr>Button<wbr>Payload"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_buttons_button_.html">"classes/buttons/<wbr>Button"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_buttons_buybutton_.html">"classes/buttons/<wbr>Buy<wbr>Button"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_buttons_callbutton_.html">"classes/buttons/<wbr>Call<wbr>Button"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_buttons_gameplaybutton_.html">"classes/buttons/<wbr>Game<wbr>Play<wbr>Button"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_buttons_loginbutton_.html">"classes/buttons/<wbr>Log<wbr>InButton"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_buttons_logoutbutton_.html">"classes/buttons/<wbr>Log<wbr>Out<wbr>Button"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_buttons_postbackbutton_.html">"classes/buttons/<wbr>Postback<wbr>Button"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_buttons_sharebutton_.html">"classes/buttons/<wbr>Share<wbr>Button"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_buttons_urlbutton_.html">"classes/buttons/URLButton"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_buttons_index_.html">"classes/buttons/index"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_index_.html">"classes/index"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_abstractmessagetemplate_.html">"classes/templates/<wbr>Abstract<wbr>Message<wbr>Template"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_airlineboardingpasstemplate_.html">"classes/templates/<wbr>Airline<wbr>Boarding<wbr>Pass<wbr>Template"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_airlinecheckintemplate_.html">"classes/templates/<wbr>Airline<wbr>Check<wbr>InTemplate"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_airlineflightupdatetemplate_.html">"classes/templates/<wbr>Airline<wbr>Flight<wbr>Update<wbr>Template"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_airlineitinerarytemplate_.html">"classes/templates/<wbr>Airline<wbr>Itinerary<wbr>Template"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_buttontemplate_.html">"classes/templates/<wbr>Button<wbr>Template"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_generictemplate_.html">"classes/templates/<wbr>Generic<wbr>Template"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_listtemplate_.html">"classes/templates/<wbr>List<wbr>Template"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_mediatemplate_.html">"classes/templates/<wbr>Media<wbr>Template"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_opengraphtemplate_.html">"classes/templates/<wbr>Open<wbr>Graph<wbr>Template"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_receipttemplate_.html">"classes/templates/<wbr>Receipt<wbr>Template"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_classes_templates_index_.html">"classes/templates/index"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_client_client_.html">"client/<wbr>Client"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_client_facebookmessageparser_.html">"client/<wbr>Facebook<wbr>Message<wbr>Parser"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_client_facebookmessagingapiclient_.html">"client/<wbr>Facebook<wbr>MessagingAPIClient"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_enums_index_.html">"enums/index"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_index_.html">"index"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_interfaces_buttons_.html">"interfaces/<wbr>Buttons"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_interfaces_connectivity_.html">"interfaces/<wbr>Connectivity"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_interfaces_messages_.html">"interfaces/<wbr>Messages"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_interfaces_quickreplies_.html">"interfaces/<wbr>Quick<wbr>Replies"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_interfaces_templates_.html">"interfaces/<wbr>Templates"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_interfaces_index_.html">"interfaces/index"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_page_facebookpageapiclient_.html">"page/<wbr>Facebook<wbr>PageAPIClient"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_page_page_.html">"page/<wbr>Page"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_profile_facebookprofileapiclient_.html">"profile/<wbr>Facebook<wbr>ProfileAPIClient"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_profile_profile_.html">"profile/<wbr>Profile"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_util_utils_.html">"util/<wbr>Utils"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_validation_validatewebhook_.html">"validation/<wbr>Validate<wbr>Webhook"</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer>
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-module"><span class="tsd-kind-icon">Module</span></li>
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-index-signature"><span class="tsd-kind-icon">Index signature</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
				<li class="tsd-kind-enum-member"><span class="tsd-kind-icon">Enumeration member</span></li>
				<li class="tsd-kind-property tsd-parent-kind-enum"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-enum"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-interface"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-class"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-call-signature tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
</body>
</html>